<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大黄鱼智能加工分拣系统 - 原型图</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/ant-design/4.16.13/antd.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* 全局样式 */
        body {
            margin: 0;
            padding: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background: #f0f2f5;
        }

        /* 布局样式 */
        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 256px;
            background: #001529;
            padding: 24px 0;
            position: fixed;
            height: 100vh;
        }

        /* Logo样式 */
        .logo {
            height: 32px;
            margin: 16px;
            color: white;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        /* 主内容区样式 */
        .main-content {
            margin-left: 256px;
            padding: 24px;
            width: calc(100% - 256px);
        }

        /* 卡片样式 */
        .card {
            background: white;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        /* 页面标题样式 */
        .page-title {
            margin-bottom: 24px;
            color: #1890ff;
            font-weight: bold;
        }

        /* 统计卡片样式 */
        .stats-card {
            background: #fafafa;
            padding: 20px;
            margin: 10px;
            border-radius: 4px;
            text-align: center;
        }

        /* 导航菜单样式 */
        .nav-menu {
            border: none;
            background: transparent;
        }

        .nav-menu a {
            color: rgba(255, 255, 255, 0.65);
            padding: 12px 24px;
            display: block;
            text-decoration: none;
        }

        .nav-menu a:hover {
            color: #1890ff;
        }

        /* 表格样式 */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            border: 1px solid #f0f0f0;
        }

        .table th {
            background: #fafafa;
        }

        /* 按钮样式 */
        .btn {
            padding: 8px 16px;
            border-radius: 2px;
            border: 1px solid #d9d9d9;
            background: white;
            cursor: pointer;
        }

        .btn-primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        /* 仪表盘网格布局 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        /* 图表容器样式 */
        .chart-container {
            height: 300px;
            background: white;
            padding: 20px;
            margin-bottom: 24px;
            position: relative;
        }

        /* 响应式布局 */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 80px;
            }

            .main-content {
                margin-left: 80px;
                width: calc(100% - 80px);
            }
        }

        /* 头部导航样式 */
        .header {
            background: white;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            position: fixed;
            width: calc(100% - 256px);
            top: 0;
            right: 0;
            z-index: 100;
        }

        .header-user {
            display: flex;
            align-items: center;
            margin-left: 24px;
        }

        /* 时间轴样式优化 */
        .blockchain-timeline {
            position: relative;
            padding-left: 32px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 32px;
            border-left: 2px solid #1890ff;
            margin-left: 16px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -9px;
            top: 0;
            width: 16px;
            height: 16px;
            background: #1890ff;
            border-radius: 50%;
        }

        /* 数据可视化样式 */
        .chart-legend {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 8px;
        }

        /* 通知样式 */
        .header-notifications {
            position: relative;
            margin-right: 24px;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -12px;
            background: #ff4d4f;
            color: white;
            border-radius: 10px;
            padding: 0 6px;
            font-size: 12px;
            min-width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
        }

        /* 设置卡片样式优化 */
        .settings-card {
            background: #fafafa;
            padding: 20px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .settings-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
            transform: translateY(-2px);
        }

        /* 加载动画 */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* 通知面板样式 */
        .notification-panel {
            position: fixed;
            top: 64px;
            right: -320px;
            width: 320px;
            height: calc(100vh - 64px);
            background: white;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
            transition: right 0.3s ease-in-out;
            z-index: 99;
            padding: 20px;
        }

        .notification-panel.active {
            right: 0;
        }

        /* 页面过渡动画 */
        .page {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease-out;
        }

        .page.enter {
            opacity: 0;
            transform: translateY(20px);
        }

        .page.active {
            opacity: 1;
            transform: translateY(0);
        }

        .page.exit {
            opacity: 0;
            transform: translateY(-20px);
        }

        /* 交互反馈样式 */
        .btn:active {
            transform: scale(0.98);
        }

        /* 区块链可视化样式补充 */
        .blockchain-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .blockchain-card {
            background: #fafafa;
            padding: 20px;
            border-radius: 4px;
            border-left: 4px solid #1890ff;
            transition: all 0.3s;
        }

        .blockchain-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .hash-text {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            color: #666;
            word-break: break-all;
            background: #f0f2f5;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* 智能合约样式 */
        .contract-form {
            background: #fafafa;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .contract-form .form-group {
            margin-bottom: 15px;
        }

        .contract-form label {
            display: block;
            margin-bottom: 5px;
        }

        .contract-form input,
        .contract-form select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d9d9d9;
            border-radius: 2px;
        }

        .contract-status {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            display: inline-block;
        }

        .status-active {
            background: #e6f7ff;
            color: #1890ff;
            border: 1px solid #91d5ff;
        }

        .status-pending {
            background: #fff7e6;
            color: #fa8c16;
            border: 1px solid #ffd591;
        }

        /* 添加图表加载状态样式 */
        .chart-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .chart-container {
            position: relative;
        }

        /* 添加数据更新开关样式 */
        .chart-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 11;
        }

        .auto-update-switch {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #666;
        }

        .switch-toggle {
            width: 36px;
            height: 20px;
            background: #ccc;
            border-radius: 10px;
            margin: 0 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .switch-toggle.active {
            background: #1890ff;
        }

        .switch-toggle::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }

        .switch-toggle.active::after {
            left: 18px;
        }

        /* 修复通知样式 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease-out;
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div class="layout">
        <div class="sidebar">
            <div class="logo">大黄鱼智能加工分拣系统</div>
            <div class="nav-menu">
                <a href="#dashboard">监控中心</a>
                <a href="#sorting">分拣管理</a>
                <a href="#quality">品质评级</a>
                <a href="#blockchain">区块链溯源</a>
                <a href="#contract">智能合约管理</a>
                <a href="#system">系统管理</a>
            </div>
        </div>
        <div class="main-content">
            <!-- 仪表盘页面 -->
            <section id="dashboard" class="page">
                <h2 class="page-title">监控中心</h2>
                <div class="dashboard-grid">
                    <div class="stats-card">
                        <h3>今日产量</h3>
                        <div class="stats-value">2,345 kg</div>
                        <div class="stats-trend">↑ 12.5%</div>
                    </div>
                    <div class="stats-card">
                        <h3>设备运行状态</h3>
                        <div class="stats-value">92%</div>
                        <div class="stats-trend">正常运行</div>
                    </div>
                    <div class="stats-card">
                        <h3>品质合格率</h3>
                        <div class="stats-value">96.8%</div>
                        <div class="stats-trend">↑ 2.3%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="auto-update-switch">
                            <span>自动更新</span>
                            <div class="switch-toggle active" onclick="toggleAutoUpdate(this)"></div>
                        </div>
                    </div>
                    <div class="chart-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="chart-body" style="width: 100%; height: 300px;"></div> <!-- 添加明确的宽高 -->
                </div>
            </section>

            <!-- 分拣管理页面 -->
            <section id="sorting" class="page" style="display: none;">
                <h2 class="page-title">分拣管理</h2>
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="auto-update-switch">
                            <span>自动更新</span>
                            <div class="switch-toggle active" onclick="toggleAutoUpdate(this)"></div>
                        </div>
                    </div>
                    <div class="chart-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="chart-body" style="width: 100%; height: 300px;"></div>
                </div>
                <div class="card">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>批次号</th>
                                <th>产品类型</th>
                                <th>计划数量</th>
                                <th>已完成</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BH20230901001</td>
                                <td>大黄鱼</td>
                                <td>1000kg</td>
                                <td>856kg</td>
                                <td>进行中</td>
                                <td>
                                    <button class="btn">详情</button>
                                    <button class="btn">暂停</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 品质评级页面 -->
            <section id="quality" class="page" style="display: none;">
                <h2 class="page-title">品质评级</h2>
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="auto-update-switch">
                            <span>自动更新</span>
                            <div class="switch-toggle active" onclick="toggleAutoUpdate(this)"></div>
                        </div>
                    </div>
                    <div class="chart-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="chart-body" style="width: 100%; height: 300px;"></div> <!-- 添加明确的宽高 -->
                </div>
                <div class="card">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>检测时间</th>
                                <th>批次号</th>
                                <th>评级结果</th>
                                <th>重量</th>
                                <th>外观评分</th>
                                <th>新鲜度</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2023-09-01 10:30:25</td>
                                <td>BH20230901001</td>
                                <td>A级</td>
                                <td>500g</td>
                                <td>95分</td>
                                <td>98%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 区块链溯源页面 -->
            <section id="blockchain" class="page" style="display: none;">
                <h2 class="page-title">区块链溯源</h2>
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="auto-update-switch">
                            <span>自动更新</span>
                            <div class="switch-toggle active" onclick="toggleAutoUpdate(this)"></div>
                        </div>
                    </div>
                    <div class="chart-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="chart-body" style="width: 100%; height: 300px;"></div>
                </div>
                <div class="card">
                    <div class="search-box" style="margin-bottom: 20px;">
                        <input type="text" id="blockchain-search" placeholder="输入批次号或区块哈希"
                            style="width: 300px; padding: 8px;">
                        <button class="btn btn-primary" onclick="searchBlockchain()">查询</button>
                    </div>
                    <div class="blockchain-info">
                        <div class="blockchain-card">
                            <h4>实时网络状态</h4>
                            <p>当前区块高度：<span id="block-height">1234567</span></p>
                            <p>节点状态：<span id="node-status" style="color: #52c41a;">正常</span></p>
                            <p>网络延迟：<span id="network-latency">23ms</span></p>
                        </div>
                        <div class="blockchain-card">
                            <h4>最新区块信息</h4>
                            <p>时间戳：<span id="block-timestamp">2023-09-01 16:45:30</span></p>
                            <p>交易数量：<span id="tx-count">15</span></p>
                            <div class="hash-text" id="block-hash">0x8f23e7a1b5c4d9f8e2a1b5c4d9f8e2a1</div>
                        </div>
                    </div>
                    <div class="blockchain-timeline" style="padding: 20px;">
                        <div class="timeline-item">
                            <h4>捕捞信息</h4>
                            <div class="timeline-content">
                                <p>时间：2023-09-01 05:30:00</p>
                                <p>位置：东海海域</p>
                                <p>船只编号：ZJ4872</p>
                                <p>区块哈希：0x8f23...</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <h4>加工信息</h4>
                            <div class="timeline-content">
                                <p>时间：2023-09-01 10:30:00</p>
                                <p>加工批次：BH20230901001</p>
                                <p>加工工艺：标准化处理</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 智能合约页面 -->
            <section id="contract" class="page" style="display: none;">
                <h2 class="page-title">智能合约管理</h2>
                <div class="card">
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="showContractForm()">创建新合约</button>
                    </div>
                    <div class="contract-form" id="contractForm" style="display: none;">
                        <div class="form-group">
                            <label>合约类型</label>
                            <select id="contractType" class="form-control">
                                <option value="quality">品质评级合约</option>
                                <option value="payment">自动结算合约</option>
                                <option value="trace">溯源记录合约</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>关联批次</label>
                            <input type="text" id="contractBatch" class="form-control" placeholder="输入批次号">
                        </div>
                        <div class="form-group">
                            <label>触发条件</label>
                            <input type="text" id="contractCondition" class="form-control" placeholder="设置触发条件">
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button class="btn" onclick="hideContractForm()">取消</button>
                            <button class="btn btn-primary" onclick="createContract()">创建</button>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>合约ID</th>
                                <th>类型</th>
                                <th>创建时间</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CT202309010001</td>
                                <td>品质评级合约</td>
                                <td>2023-09-01</td>
                                <td><span class="contract-status status-active">已激活</span></td>
                                <td>
                                    <button class="btn">查看</button>
                                    <button class="btn">终止</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 系统管理页面 -->
            <section id="system" class="page" style="display: none;">
                <h2 class="page-title">系统管理</h2>
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>用户管理</h3>
                        <div class="settings-content">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>用户名</th>
                                        <th>角色</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>admin</td>
                                        <td>管理员</td>
                                        <td>启用</td>
                                        <td>
                                            <button class="btn">编辑</button>
                                            <button class="btn">禁用</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3>系统参数配置</h3>
                        <div class="settings-content">
                            <div class="form-group">
                                <label>数据更新频率</label>
                                <select class="form-control" id="updateInterval">
                                    <option value="5000">5秒</option>
                                    <option value="10000">10秒</option>
                                    <option value="30000">30秒</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>数据保留天数</label>
                                <input type="number" class="form-control" id="dataRetention" value="30">
                            </div>
                            <button class="btn btn-primary" onclick="saveSystemSettings()">保存配置</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // 声明图表配置对象
        const chartConfigs = {
            dashboardOption: {
                title: {
                    text: '监控中心概览',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [
                    {
                        name: '系统状态',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: 735, name: '正常运行' },
                            { value: 210, name: '警告' },
                            { value: 34, name: '错误' },
                            { value: 135, name: '离线' },
                            { value: 548, name: '待机' }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            },
            productionOption: {
                title: {
                    text: '生产线实时状态',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'normal'
                    },
                    left: '3%'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            backgroundColor: '#6a7985'
                        }
                    }
                },
                legend: {
                    data: ['产量', '速度', '合格率'],
                    top: 25
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: true,
                    data: ['8:00', '9:00', '10:00', '11:00', '12:00'],
                    axisLabel: {
                        rotate: 30
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '产量 (kg)',
                        position: 'left',
                        axisLine: {
                            lineStyle: {
                                color: '#5470C6'
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: '速度/合格率',
                        max: 100,
                        position: 'right',
                        axisLine: {
                            lineStyle: {
                                color: '#91CC75'
                            }
                        }
                    }
                ],
                series: [
                    {
                        name: '产量',
                        type: 'bar',
                        data: [820, 932, 901, 934, 890],
                        itemStyle: {
                            color: '#5470C6'
                        },
                        emphasis: {
                            focus: 'series'
                        },
                        animationDuration: 1000
                    },
                    {
                        name: '速度',
                        type: 'line',
                        yAxisIndex: 1,
                        data: [95, 89, 92, 88, 94],
                        lineStyle: {
                            width: 3
                        }
                    },
                    {
                        name: '合格率',
                        type: 'line',
                        yAxisIndex: 1,
                        data: [97, 96, 98, 95, 97],
                        lineStyle: {
                            width: 3
                        }
                    }
                ]
            },
            qualityOption: {
                title: {
                    text: '品质评级趋势',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                legend: {
                    data: ['外观评分', '新鲜度指数', '重量合格率'],
                    bottom: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: Array.from({ length: 24 }, (_, i) =>
                        new Date(Date.now() - (23 - i) * 3600 * 1000).getHours() + ':00'
                    )
                },
                yAxis: {
                    type: 'value',
                    name: '分数/比率',
                    max: 100,
                    axisLabel: {
                        formatter: '{value}%'
                    }
                },
                series: [
                    {
                        name: '外观评分',
                        type: 'line',
                        data: Array(24).fill(0).map(() => (Math.random() * 10 + 85).toFixed(1)),
                        smooth: true,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#1890ff'
                        }
                    },
                    {
                        name: '新鲜度指数',
                        type: 'line',
                        data: Array(24).fill(0).map(() => (Math.random() * 8 + 90).toFixed(1)),
                        smooth: true,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#52c41a'
                        }
                    },
                    {
                        name: '重量合格率',
                        type: 'line',
                        data: Array(24).fill(0).map(() => (Math.random() * 5 + 94).toFixed(1)),
                        smooth: true,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#faad14'
                        }
                    }
                ]
            },
            qualityAnalysisOption: {
                title: {
                    text: '品质等级分布',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: ['A级', 'B级', 'C级', 'D级']
                },
                series: [
                    {
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: true,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: 20,
                                fontWeight: 'bold'
                            }
                        },
                        data: [
                            { value: 40, name: 'A级', itemStyle: { color: '#52c41a' } },
                            { value: 32, name: 'B级', itemStyle: { color: '#1890ff' } },
                            { value: 20, name: 'C级', itemStyle: { color: '#faad14' } },
                            { value: 8, name: 'D级', itemStyle: { color: '#ff4d4f' } }
                        ]
                    }
                ]
            },
            blockchainOption: {
                title: {
                    text: '区块链数据趋势',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                xAxis: {
                    type: 'category',
                    data: Array.from({ length: 10 }, (_, i) => `Block ${i + 1}`),
                    axisLabel: {
                        interval: 0,
                        rotate: 30
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '交易数量'
                },
                series: [
                    {
                        type: 'bar',
                        data: Array.from({ length: 10 }, () => ({
                            value: Math.round(Math.random() * 15 + 5),
                            time: new Date().toLocaleString()
                        })),
                        itemStyle: {
                            color: '#1890ff'
                        },
                        emphasis: {
                            itemStyle: {
                                color: '#40a9ff'
                            }
                        }
                    }
                ]
            },
            sortingOption: {
                title: {
                    text: '分拣管理概览',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['分拣速度', '准确率', '负载率'],
                    bottom: 10
                },
                xAxis: {
                    type: 'category',
                    data: Array.from({ length: 24 }, (_, i) => `${i}:00`)
                },
                yAxis: [
                    {
                        type: 'value',
                        name: '速度(件/分)',
                    },
                    {
                        type: 'value',
                        name: '比率(%)',
                        max: 100
                    }
                ],
                series: [
                    {
                        name: '分拣速度',
                        type: 'bar',
                        data: Array(24).fill(0).map(() => Math.round(Math.random() * 30 + 60))
                    },
                    {
                        name: '准确率',
                        type: 'line',
                        yAxisIndex: 1,
                        data: Array(24).fill(0).map(() => Math.round(Math.random() * 5 + 94))
                    },
                    {
                        name: '负载率',
                        type: 'line',
                        yAxisIndex: 1,
                        data: Array(24).fill(0).map(() => Math.round(Math.random() * 20 + 70))
                    }
                ]
            }
        };

        // 自动更新配置
        let autoUpdateConfig = {
            interval: parseInt(localStorage.getItem('updateInterval')) || 5000,
            enabled: JSON.parse(localStorage.getItem('autoUpdateEnabled') || 'true')
        };

        // 页面初始化
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
            setupEventListeners();

            // 确保初始页面的图表正确渲染
            setTimeout(() => {
                const dashboardPage = document.getElementById('dashboard');
                if (dashboardPage && dashboardPage.style.display !== 'none') {
                    initCharts();
                }
            }, 100);
        });

        // 页面初始化函数
        function initializePage() {
            // 先创建和添加所有必需的DOM元素
            createHeaderAndNotificationPanel();
            createLoadingElement();

            // 在DOM元素创建后设置事件监听器
            setupNotificationPanel();

            const dashboardPage = document.getElementById('dashboard');
            if (dashboardPage) {
                dashboardPage.style.display = 'block';
                dashboardPage.classList.add('active');

                requestAnimationFrame(() => {
                    try {
                        initCharts();
                        startAutoUpdate();
                        setupEventListeners(); // 移到这里确保DOM已创建
                    } catch (error) {
                        console.error('初始化失败:', error);
                    } finally {
                        document.getElementById('loading').style.display = 'none';
                    }
                });
            }
        }

        // 添加DOM元素创建函数
        function createHeaderAndNotificationPanel() {
            // 创建头部导航
            const header = document.createElement('header');
            header.className = 'header';
            header.innerHTML = `
                <div class="header-notifications" style="cursor: pointer;">
                    <span>通知</span>
                    <span class="badge">5</span>
                </div>
                <div class="header-user">
                    <span>管理员</span>
                    <button class="btn">退出</button>
                </div>
            `;

            // 创建通知面板
            const notificationPanel = document.createElement('div');
            notificationPanel.id = 'notificationPanel';
            notificationPanel.className = 'notification-panel';
            notificationPanel.innerHTML = `
                <h3>通知列表</h3>
                <div class="notification-list">
                    <div class="notification-item">暂无通知</div>
                </div>
            `;

            // 按顺序添加元素
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.prepend(header);
                document.body.appendChild(notificationPanel);
            }
        }

        function createLoadingElement() {
            const loadingEl = document.createElement('div');
            loadingEl.id = 'loading';
            loadingEl.className = 'loading';
            loadingEl.innerHTML = '<div class="loading-spinner"></div>';
            document.body.appendChild(loadingEl);
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 导航菜单点击事件
            const menuLinks = document.querySelectorAll('.nav-menu a');
            if (menuLinks) {
                menuLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = e.target.getAttribute('href')?.substring(1);
                        if (targetId) {
                            switchPage(targetId);
                        }
                    });
                });
            }

            // 通知面板事件 - 确保只绑定一次
            const notificationBtn = document.querySelector('.header-notifications');
            const notificationPanel = document.getElementById('notificationPanel');

            if (notificationBtn && notificationPanel) {
                // 移除可能存在的旧事件监听器
                const newNotificationBtn = notificationBtn.cloneNode(true);
                notificationBtn.parentNode.replaceChild(newNotificationBtn, notificationBtn);

                // 添加新的事件监听器
                newNotificationBtn.addEventListener('click', () => {
                    notificationPanel.classList.toggle('active');
                });
            }
        }

        // 页面切换函数
        function switchPage(targetId) {
            const currentPage = document.querySelector('.page.active');
            const targetPage = document.getElementById(targetId);

            if (currentPage === targetPage) return;

            if (currentPage) {
                currentPage.classList.add('exit');
                setTimeout(() => {
                    currentPage.style.display = 'none';
                    currentPage.classList.remove('active', 'exit');
                }, 300);
            }

            if (targetPage) {
                targetPage.style.display = 'block';
                targetPage.classList.add('enter');
                setTimeout(() => {
                    requestAnimationFrame(() => {
                        targetPage.classList.add('active');
                        targetPage.classList.remove('enter');
                        initPageCharts(targetId);
                    });
                }, 50);
            }
        }

        // 初始化图表
        function initCharts() {
            if (!window.echarts) {
                console.error('ECharts 未加载');
                return;
            }

            // 重置图表实例对象
            window.chartInstances = {};

            // 获取当前显示的页面
            const activePage = document.querySelector('.page[style*="display: block"]');
            if (!activePage) {
                console.warn('没有找到活动页面');
                return;
            }

            const pageId = activePage.id;
            console.log('初始化页面图表:', pageId);

            const containers = activePage.querySelectorAll('.chart-container');
            containers.forEach((container, index) => {
                const chartBody = container.querySelector('.chart-body');
                if (!chartBody) return;

                try {
                    const chart = echarts.init(chartBody);
                    const optionKey = pageId + (index === 0 ? 'Option' : 'AnalysisOption');

                    if (chartConfigs[optionKey]) {
                        chart.setOption(chartConfigs[optionKey]);
                        window.chartInstances[pageId + index] = chart;

                        if (autoUpdateConfig.enabled) {
                            startChartUpdate(chart);
                        }
                    }
                } catch (error) {
                    console.error(`初始化图表失败: ${pageId}`, error);
                }
            });
        }

        // 自动更新图表
        function startAutoUpdate() {
            if (!window.chartInstances) return;

            Object.values(window.chartInstances).forEach(chart => {
                if (autoUpdateConfig.enabled) {
                    startChartUpdate(chart);
                }
            });
        }

        function startChartUpdate(chart) {
            if (chart._autoUpdateTimer) {
                clearInterval(chart._autoUpdateTimer);
            }

            const option = chart.getOption();
            chart._autoUpdateTimer = setInterval(() => {
                updateChartData(chart, option);
            }, autoUpdateConfig.interval);
        }

        function stopChartUpdate(chart) {
            if (chart._autoUpdateTimer) {
                clearInterval(chart._autoUpdateTimer);
                chart._autoUpdateTimer = null;
            }
        }

        // 更新图表数据
        function updateChartData(chart, option) {
            if (!chart || !option) return;

            try {
                const seriesType = option.series[0]?.type;
                if (!seriesType) return;

                switch (seriesType) {
                    case 'bar':
                        updateBarChartData(chart, option);
                        break;
                    case 'line':
                        updateLineChartData(chart, option);
                        break;
                    case 'pie':
                        updateQualityData(chart);
                        break;
                }
            } catch (error) {
                console.error('更新图表数据失败:', error);
            }
        }

        function updateBarChartData(chart, option) {
            const now = new Date();
            const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

            option.xAxis[0].data.shift();
            option.xAxis[0].data.push(time);

            option.series.forEach((series, index) => {
                series.data.shift();
                series.data.push(generateRandomData(series.type));
            });

            chart.setOption(option);
        }

        function updateLineChartData(chart, option) {
            option.series.forEach(series => {
                series.data.shift();
                series.data.push(generateRandomData(series.type));
            });

            chart.setOption(option);
        }

        function generateRandomData(type) {
            switch (type) {
                case 'bar':
                    return {
                        value: Math.round(Math.random() * 200 + 800),
                        itemStyle: {
                            color: '#5470C6',
                            opacity: 0.8
                        }
                    };
                case 'line':
                    return Math.round(Math.random() * 10 + 85);
                default:
                    return 0;
            }
        }

        // 更新品质数据
        function updateQualityData(chart) {
            const option = chart.getOption();
            if (!option || !option.series || !option.series[0]) return;

            option.series[0].data = [
                { value: Math.round(Math.random() * 400 + 500), name: 'A级' },
                { value: Math.round(Math.random() * 300 + 400), name: 'B级' },
                { value: Math.round(Math.random() * 200 + 300), name: 'C级' },
                { value: Math.round(Math.random() * 100 + 200), name: 'D级' }
            ];
            chart.setOption(option);
        }

        // 添加区块链搜索功能
        function searchBlockchain() {
            const searchInput = document.getElementById('blockchain-search').value;
            document.getElementById('loading').style.display = 'flex';

            // 模拟搜索延迟
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                // 这里添加实际的搜索逻辑
                updateBlockchainInfo({
                    height: Math.floor(Math.random() * 1000000 + 1000000),
                    timestamp: new Date().toLocaleString(),
                    txCount: Math.floor(Math.random() * 20 + 10),
                    hash: '0x' + Math.random().toString(16).slice(2, 34)
                });
            }, 1000);
        }

        // 更新区块链信息
        function updateBlockchainInfo(data) {
            document.getElementById('block-height').textContent = data.height;
            document.getElementById('block-timestamp').textContent = data.timestamp;
            document.getElementById('tx-count').textContent = data.txCount;
            document.getElementById('block-hash').textContent = data.hash;
            document.getElementById('network-latency').textContent = Math.floor(Math.random() * 50 + 10) + 'ms';
        }

        // 定时更新区块链信息
        setInterval(() => {
            updateBlockchainInfo({
                height: parseInt(document.getElementById('block-height').textContent) + 1,
                timestamp: new Date().toLocaleString(),
                txCount: Math.floor(Math.random() * 20 + 10),
                hash: '0x' + Math.random().toString(16).slice(2, 34)
            });
        }, 10000);

        // 通知面板控制
        function setupNotificationPanel() {
            const notificationBtn = document.querySelector('.header-notifications');
            const notificationPanel = document.getElementById('notificationPanel');

            if (notificationBtn && notificationPanel) {
                // 移除可能存在的旧事件监听器
                const newNotificationBtn = notificationBtn.cloneNode(true);
                notificationBtn.parentNode.replaceChild(newNotificationBtn, notificationBtn);

                // 添加新的事件监听器
                newNotificationBtn.addEventListener('click', () => {
                    notificationPanel.classList.toggle('active');
                });
            }
        }

        // 合约表单控制
        function showContractForm() {
            document.getElementById('contractForm').style.display = 'block';
        }

        function hideContractForm() {
            document.getElementById('contractForm').style.display = 'none';
        }

        // 创建合约功能
        function createContract() {
            const formData = {
                type: document.getElementById('contractType').value,
                batch: document.getElementById('contractBatch').value,
                condition: document.getElementById('contractCondition').value
            };

            if (!validateContractForm(formData)) {
                showNotification('请填写完整的合约信息');
                return;
            }

            document.getElementById('loading').style.display = 'flex';

            // 模拟合约创建延迟
            setTimeout(() => {
                const contract = {
                    id: 'CT' + Date.now(),
                    type: formData.type,
                    batch: formData.batch,
                    condition: formData.condition,
                    status: 'pending',
                    createTime: new Date().toLocaleDateString()
                };
                addContractToTable(contract);
                hideContractForm();
                document.getElementById('loading').style.display = 'none';
                showNotification('合约创建成功');
            }, 1000);
        }

        function validateContractForm(data) {
            return data.type && data.batch && data.condition;
        }

        function addContractToTable(contract) {
            const table = document.querySelector('#contract .table tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${contract.id}</td>
                <td>${getContractTypeName(contract.type)}</td>
                <td>${contract.createTime}</td>
                <td><span class="contract-status status-${contract.status}">${getStatusText(contract.status)}</span></td>
                <td>
                    <button class="btn" onclick="viewContract('${contract.id}')">查看</button>
                    <button class="btn btn-primary" onclick="activateContract('${contract.id}')">激活</button>
                </td>
            `;
            table.appendChild(row);
        }

        function getContractTypeName(type) {
            switch (type) {
                case 'quality':
                    return '品质评级合约';
                case 'payment':
                    return '自动结算合约';
                case 'trace':
                    return '溯源记录合约';
                default:
                    return '未知类型';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'active':
                    return '已激活';
                case 'pending':
                    return '待激活';
                default:
                    return '未知状态';
            }
        }

        function viewContract(id) {
            showNotification(`查看合约 ${id}`);
        }

        function activateContract(id) {
            showNotification(`激活合约 ${id}`);
        }

        // 添加自动刷新配置持久化
        function saveSystemSettings() {
            const interval = document.getElementById('updateInterval').value;
            const retention = document.getElementById('dataRetention').value;

            localStorage.setItem('updateInterval', interval);
            localStorage.setItem('dataRetention', retention);

            autoUpdateConfig.interval = parseInt(interval);
            showNotification('系统设置已保存');
        }

        // 自动更新开关控制
        function toggleAutoUpdate(element) {
            const isActive = element.classList.toggle('active');
            autoUpdateConfig.enabled = isActive;
            localStorage.setItem('autoUpdateEnabled', isActive);

            const chartContainer = element.closest('.chart-container');
            const chartBody = chartContainer.querySelector('.chart-body');
            const chart = echarts.getInstanceByDom(chartBody);

            if (chart) {
                if (isActive) {
                    startChartUpdate(chart);
                } else {
                    stopChartUpdate(chart);
                }
            }
        }

        // 通知提示功能
        function showNotification(message) {
            if (!message) return;

            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;

            // 确保移除旧的通知
            const oldNotification = document.querySelector('.notification');
            if (oldNotification) {
                oldNotification.remove();
            }

            document.body.appendChild(notification);

            // 使用 requestAnimationFrame 确保动画正常工作
            requestAnimationFrame(() => {
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            });
        }

        // 添加页面图表初始化函数
        function initPageCharts(targetId) {
            requestAnimationFrame(() => {
                try {
                    // 清除当前页面的图表实例
                    if (window.chartInstances) {
                        Object.values(window.chartInstances).forEach(chart => {
                            chart.dispose();
                        });
                        window.chartInstances = {};
                    }

                    // 获取目标页面的图表容器
                    const targetPage = document.getElementById(targetId);
                    if (!targetPage) return;

                    const containers = targetPage.querySelectorAll('.chart-container');
                    containers.forEach((container, index) => {
                        const chartBody = container.querySelector('.chart-body');
                        if (!chartBody) return;

                        try {
                            const chart = echarts.init(chartBody);
                            const optionKey = index === 0 ? targetId + 'Option' : 'qualityAnalysisOption';

                            if (chartConfigs[optionKey]) {
                                chart.setOption(chartConfigs[optionKey]);
                                window.chartInstances[targetId + index] = chart;

                                // 如果自动更新已启用，开始更新
                                if (autoUpdateConfig.enabled) {
                                    startChartUpdate(chart);
                                }
                            }
                        } catch (error) {
                            console.error(`初始化图表失败: ${targetId}`, error);
                        }
                    });
                } catch (error) {
                    console.error('切换页面图表初始化失败:', error);
                }
            });
        }
    </script>
</body>

</html>